<local:AddressManagerPageBase x:Class="Tuvi.App.Shared.Views.AddressManagerPage"
                              xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                              xmlns:controls="using:Tuvi.App.Shared.Controls"
                              xmlns:converters="using:Tuvi.App.Converters"
                              xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                              xmlns:local="using:Tuvi.App.Shared.Views"
                              xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                              xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
                              xmlns:viewmodels="using:Tuvi.App.ViewModels"
                              Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                              mc:Ignorable="d">

    <local:AddressManagerPageBase.DataContext>
        <viewmodels:AddressManagerPageViewModel />
    </local:AddressManagerPageBase.DataContext>


    <local:AddressManagerPageBase.Resources>
        <converters:BoolToIntConverter x:Key="BoolToGridRowConverter"
                                       FalseValue="1"
                                       TrueValue="0" />

        <x:Double x:Key="ButtonMinWidth">120</x:Double>
        <x:Double x:Key="IconSize">32</x:Double>
        <x:Double x:Key="FirstColumnWidth">256</x:Double>

        <Thickness x:Key="PageHorizontalContentPadding">44,0,48,0</Thickness>

        <DataTemplate x:Key="AddressTemplate" x:DataType="viewmodels:AddressItem">
            <controls:AddressItemControl Address="{x:Bind Address, Mode=OneWay}"
                                         Avatar="{x:Bind local:AddressManagerPage.GetAvatar(AvatarInfo), Mode=OneWay}"
                                         DisplayName="{x:Bind DisplayName, Mode=OneWay}"
                                         Invoked="OnItemInvoked"
                                         Tag="{x:Bind}" />
        </DataTemplate>

        <DataTemplate x:Key="AddressGroupTemplate" x:DataType="viewmodels:AddressGroupItem">
            <Grid x:Name="Root">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" MinWidth="{StaticResource ButtonMinWidth}" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Row="{x:Bind IsAnyAddress, Mode=OneWay, Converter={StaticResource BoolToGridRowConverter}}"
                      Width="{StaticResource FirstColumnWidth}"
                      Margin="0,16,0,0"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Top">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Image Width="{StaticResource IconSize}"
                           Height="{StaticResource IconSize}"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           Source="{x:Bind local:AddressManagerPage.GetGroupImage(Type)}"
                           Stretch="Uniform"
                           Visibility="{x:Bind local:AddressManagerPage.GetImageVisibility(Type)}" />

                    <FontIcon Width="{StaticResource IconSize}"
                              Height="{StaticResource IconSize}"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Top"
                              FontFamily="{ThemeResource SymbolThemeFontFamily}"
                              Glyph="&#xE83B;"
                              Visibility="{x:Bind local:AddressManagerPage.GetFontIconVisibility(Type)}" />

                    <TextBlock Grid.Column="1"
                               Margin="12,0"
                               VerticalAlignment="Center"
                               Text="{x:Bind GroupTitle}"
                               TextTrimming="CharacterEllipsis" />
                </Grid>

                <muxc:ItemsRepeater Grid.Column="1"
                                    Grid.ColumnSpan="2"
                                    Margin="0,16,0,0"
                                    ItemTemplate="{StaticResource AddressTemplate}"
                                    ItemsSource="{x:Bind Items, Mode=OneWay}"
                                    Visibility="{x:Bind IsAnyAddress, Mode=OneWay}">
                    <muxc:ItemsRepeater.Layout>
                        <muxc:StackLayout Orientation="Vertical" Spacing="4" />
                    </muxc:ItemsRepeater.Layout>
                </muxc:ItemsRepeater>

                <Button x:Uid="AddAddressButton"
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="0,16,12,16"
                        Click="OnAddAddressButtonClick"
                        Tag="{x:Bind}" />

                <Border Grid.Row="1"
                        Grid.Column="2"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Background="{ThemeResource SolidBackgroundFillColorBaseAltBrush}"
                        CornerRadius="4"
                        Visibility="{x:Bind IsTestnet, Mode=OneTime}">

                    <TextBlock x:Uid="TestnetLabel"
                               Margin="8,2"
                               FontSize="12"
                               TextTrimming="CharacterEllipsis" />
                </Border>

                <Border Grid.Row="2"
                        Grid.ColumnSpan="3"
                        Height="1"
                        VerticalAlignment="Bottom"
                        Background="{ThemeResource SolidBackgroundFillColorBaseAltBrush}"
                        Visibility="{x:Bind IsLastGroup, Mode=OneTime, Converter={StaticResource InverseBoolToVisibilityConverter}}" />
            </Grid>
        </DataTemplate>
    </local:AddressManagerPageBase.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock x:Uid="AddressManagerTitle"
                   Margin="0,24"
                   Padding="{StaticResource PageHorizontalContentPadding}" />

        <ScrollViewer Grid.Row="1"
                      Padding="{StaticResource PageHorizontalContentPadding}"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalScrollMode="Disabled"
                      IsHorizontalScrollChainingEnabled="False"
                      VerticalScrollBarVisibility="Auto"
                      VerticalScrollMode="Auto">

            <Grid Grid.Row="0" Margin="0,12,0,40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="8" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock x:Uid="AddressListHeader"
                           Width="{StaticResource FirstColumnWidth}"
                           TextTrimming="CharacterEllipsis" />

                <TextBlock x:Uid="AddressListNote"
                           Grid.Column="1"
                           TextTrimming="CharacterEllipsis" />

                <muxc:ItemsRepeater Grid.Row="2"
                                    Grid.ColumnSpan="2"
                                    ItemTemplate="{StaticResource AddressGroupTemplate}"
                                    ItemsSource="{x:Bind ViewModel.GroupItems}">
                    <muxc:ItemsRepeater.Layout>
                        <muxc:StackLayout Orientation="Vertical" />
                    </muxc:ItemsRepeater.Layout>
                </muxc:ItemsRepeater>
            </Grid>

        </ScrollViewer>
    </Grid>

</local:AddressManagerPageBase>
