<local:InvitationPageBase x:Class="Eppie.App.Views.InvitationPage"
                          xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                          xmlns:behaviors="using:Eppie.App.UI.Behaviors"
                          xmlns:controls="using:Eppie.App.UI.Controls"
                          xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                          xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
                          xmlns:local="using:Eppie.App.Views"
                          xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                          xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
                          xmlns:viewmodels="using:Tuvi.App.ViewModels"
                          Background="Transparent"
                          mc:Ignorable="d">

    <local:InvitationPageBase.DataContext>
        <viewmodels:InvitationPageViewModel />
    </local:InvitationPageBase.DataContext>

    <local:InvitationPageBase.Resources>
        <x:Double x:Key="PageWidth">428</x:Double>
        <Thickness x:Key="PageContentPadding">24,18,24,24</Thickness>
        <x:Double x:Key="PictureSize">28</x:Double>
        <Thickness x:Key="ElementMargin">0,0,12,0</Thickness>

        <DataTemplate x:Key="ContactComboboxItemTemplate" x:DataType="viewmodels:ContactItem">
            <Grid HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="10*" MaxWidth="72" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!--  ToDo: ProfilePicture="{x:Bind Avatar, Mode=OneWay}"  -->
                <muxc:PersonPicture Width="{StaticResource PictureSize}"
                                    Height="{StaticResource PictureSize}"
                                    Margin="{StaticResource ElementMargin}"
                                    VerticalAlignment="Center"
                                    DisplayName="{x:Bind DisplayName, Mode=OneWay}" />

                <TextBlock Grid.Column="1"
                           VerticalAlignment="Center"
                           Text="{x:Bind DisplayName, Mode=OneWay}" />
                <TextBlock Grid.Column="2"
                           VerticalAlignment="Center"
                           Text="{x:Bind Email.Address, Mode=OneWay}" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="AddressComboboxItemTemplate" x:DataType="viewmodels:AddressItem">
            <Grid HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="10*" MaxWidth="72" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!--  ToDo: ProfilePicture="{x:Bind Avatar, Mode=OneWay}"  -->
                <muxc:PersonPicture Width="{StaticResource PictureSize}"
                                    Height="{StaticResource PictureSize}"
                                    Margin="{StaticResource ElementMargin}"
                                    VerticalAlignment="Center"
                                    DisplayName="{x:Bind DisplayName, Mode=OneWay}" />

                <TextBlock Grid.Column="1"
                           VerticalAlignment="Center"
                           Text="{x:Bind DisplayName, Mode=OneWay}" />
                <TextBlock Grid.Column="2"
                           VerticalAlignment="Center"
                           Text="{x:Bind Address, Mode=OneWay}" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="RecipientTemplate" x:DataType="viewmodels:ContactItem">
            <!--  ToDo: Avatar="{x:Bind local:AddressManagerPage.GetAvatar(AvatarInfo), Mode=OneWay}"  -->
            <controls:AddressItemControl Address="{x:Bind Email.Address, Mode=OneWay}"
                                         DisplayName="{x:Bind DisplayName, Mode=OneWay}"
                                         Invoked="OnRecipientRemoved"
                                         Tag="{x:Bind}" />
        </DataTemplate>

    </local:InvitationPageBase.Resources>

    <Grid Width="{StaticResource PageWidth}">
        <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                      HorizontalScrollMode="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      VerticalScrollMode="Auto"
                      ZoomMode="Disabled">
            <StackPanel Padding="{StaticResource PageContentPadding}" Orientation="Vertical">
                <TextBlock x:Uid="InvitationPageTitle" Margin="0,0,0,20" />
                <TextBlock x:Uid="InvitationPageHeader"
                           Margin="0,0,0,16"
                           FontSize="20"
                           FontWeight="Medium" />
                <TextBlock x:Uid="InvitationPageNote"
                           Margin="0,0,0,20"
                           TextWrapping="WrapWholeWords" />
                <ComboBox x:Uid="InvitationSenderAddressComboBox"
                          Margin="0,0,0,32"
                          HorizontalAlignment="Stretch"
                          ItemTemplate="{StaticResource AddressComboboxItemTemplate}"
                          ItemsSource="{x:Bind ViewModel.SenderAddresses, Mode=OneWay}"
                          SelectedIndex="{x:Bind ViewModel.SenderAddressIndex, Mode=TwoWay}" />
                <TextBlock x:Uid="InvitationRecipientAddressHeader"
                           Margin="0,0,0,8"
                           FontSize="16" />
                <AutoSuggestBox x:Uid="InvitationContactSuggestBox"
                                HorizontalAlignment="Stretch"
                                ItemTemplate="{StaticResource ContactComboboxItemTemplate}"
                                ItemsSource="{x:Bind ViewModel.SuitableContacts, Mode=OneWay}"
                                QueryIcon="PhoneBook"
                                QuerySubmitted="OnContactQuerySubmitted"
                                TextChanged="OnContactQueryChanged" />

                <muxc:ItemsRepeater Margin="0,12,0,0"
                                    HorizontalAlignment="Stretch"
                                    ItemTemplate="{StaticResource RecipientTemplate}"
                                    ItemsSource="{x:Bind ViewModel.Recipients, Mode=OneWay}"
                                    Visibility="{x:Bind ViewModel.IsAnyRecipient, Mode=OneWay}">
                    <muxc:ItemsRepeater.Layout>
                        <muxc:StackLayout Orientation="Vertical" Spacing="4" />
                    </muxc:ItemsRepeater.Layout>
                </muxc:ItemsRepeater>

                <ComboBox x:Uid="InvitationEppieAddressComboBox"
                          Margin="0,32,0,0"
                          HorizontalAlignment="Stretch"
                          ItemTemplate="{StaticResource AddressComboboxItemTemplate}"
                          ItemsSource="{x:Bind ViewModel.EppieAddresses, Mode=OneWay}"
                          SelectedIndex="{x:Bind ViewModel.EppieAddressIndex, Mode=TwoWay}" />

                <Button x:Uid="SendInviteButton"
                        Margin="0,28,0,0"
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.SendInviteCommand, Mode=OneWay}"
                        IsEnabled="{x:Bind ViewModel.CanInvite, Mode=OneWay}"
                        Style="{StaticResource AccentButtonStyle}" />

            </StackPanel>
        </ScrollViewer>
    </Grid>
</local:InvitationPageBase>
