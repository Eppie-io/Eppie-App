<local:LocalAIAgentSettingsPageBase x:Class="Eppie.App.Views.LocalAIAgentSettingsPage"
                                    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                    xmlns:behaviors="using:Eppie.App.UI.Behaviors"
                                    xmlns:controls="using:Eppie.App.UI.Controls"
                                    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                                    xmlns:extensions="using:Eppie.App.UI.Extensions"
                                    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
                                    xmlns:local="using:Eppie.App.Views"
                                    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                                    xmlns:viewmodels="using:Tuvi.App.ViewModels"
                                    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                    mc:Ignorable="d">

    <local:LocalAIAgentSettingsPageBase.Resources>
        <x:Double x:Key="NormalOptionGapHeight">36</x:Double>
    </local:LocalAIAgentSettingsPageBase.Resources>

    <local:LocalAIAgentSettingsPageBase.DataContext>
        <viewmodels:LocalAIAgentSettingsPageViewModel />
    </local:LocalAIAgentSettingsPageBase.DataContext>

    <interactivity:Interaction.Behaviors>
        <behaviors:DialogBehavior ApplyCommand="{x:Bind ViewModel.ApplySettingsCommand}"
                                  CancelCommand="{x:Bind ViewModel.CancelSettingsCommand}"
                                  HandleErrorCommand="{x:Bind ViewModel.HandleErrorCommand}" />
    </interactivity:Interaction.Behaviors>

    <controls:AddressSettingsView x:Uid="AIAgentSettingsView"
                                  ApplyCommand="{x:Bind ViewModel.ApplySettingsCommand}"
                                  CancelCommand="{x:Bind ViewModel.CancelSettingsCommand}"
                                  IsApplying="{x:Bind ViewModel.IsWaitingResponse, Mode=OneWay}"
                                  IsRemoveButtonVisible="{x:Bind ViewModel.IsCreatingAgentMode, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                                  RemoveCommand="{x:Bind ViewModel.RemoveAgentCommand}">
        <StackPanel>

            <controls:OptionControl x:Uid="AIModelOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                <StackPanel Orientation="Horizontal">
                    <Button x:Uid="ImportLocalAIModelButton"
                            Command="{x:Bind ViewModel.ImportLocalAIModelCommand}"
                            Visibility="{x:Bind ViewModel.IsImportAIModelButtonVisible, Mode=OneWay}" />
                    <Button x:Uid="DeleteLocalAIModelButton"
                            Command="{x:Bind ViewModel.DeleteLocalAIModelCommand}"
                            Visibility="{x:Bind ViewModel.IsDeleteAIModelButtonVisible, Mode=OneWay}" />
                    <ProgressRing Width="20"
                                  Height="20"
                                  Margin="12,0,0,0"
                                  IsActive="True"
                                  Visibility="{x:Bind ViewModel.IsAIProgressRingVisible, Mode=OneWay}" />
                    <!--  TODO: Temporary link to the documentation  -->
                    <HyperlinkButton Margin="12,0,0,0"
                                     extensions:HyperlinkExtension.Link="https://blog.eppie.io/post/eppie-ai/"
                                     Content="How to set up your AI agent" />
                </StackPanel>
            </controls:OptionControl>

            <controls:OptionControl x:Uid="AIAgentNameOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                <TextBox HorizontalAlignment="Stretch"
                         IsSpellCheckEnabled="False"
                         Text="{x:Bind ViewModel.AgentSettingsModel.Name, Mode=TwoWay}" />
            </controls:OptionControl>

            <controls:OptionControl x:Uid="AgentSpecialtyOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                <StackPanel Orientation="Horizontal">
                    <ComboBox x:Uid="AgentSpecialtyCombobox"
                              VerticalAlignment="Center"
                              ItemsSource="{x:Bind ViewModel.AgentSettingsModel.Specialties}"
                              SelectedItem="{x:Bind ViewModel.AgentSettingsModel.AgentSpecialty, Mode=TwoWay}" />
                    <ComboBox x:Uid="TargetLanguageCombobox"
                              Margin="12,0,0,0"
                              VerticalAlignment="Center"
                              ItemsSource="{x:Bind ViewModel.AgentSettingsModel.Languages}"
                              SelectedItem="{x:Bind ViewModel.AgentSettingsModel.Language, Mode=TwoWay}"
                              Visibility="{x:Bind ViewModel.AgentSettingsModel.IsLanguageVisible, Mode=OneWay}" />
                </StackPanel>
            </controls:OptionControl>

            <controls:OptionControl x:Uid="SystemPromptOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                <TextBox MinHeight="96"
                         MaxHeight="800"
                         HorizontalAlignment="Stretch"
                         AcceptsReturn="True"
                         Text="{x:Bind ViewModel.AgentSettingsModel.SystemPrompt, Mode=TwoWay}"
                         TextWrapping="Wrap" />
            </controls:OptionControl>

            <controls:AdvancedSettingsControl HideResetButton="True">
                <StackPanel>

                    <controls:OptionControl x:Uid="LinkedAccountOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <ComboBox VerticalAlignment="Center"
                                      ItemsSource="{x:Bind ViewModel.AccountsList}"
                                      SelectedItem="{x:Bind ViewModel.LinkedAccount, Mode=TwoWay}" />
                            <CheckBox x:Uid="AllowSendEmailsCheckBox" IsChecked="{x:Bind ViewModel.AgentSettingsModel.IsAllowedToSendingEmails, Mode=TwoWay}" />
                        </StackPanel>
                    </controls:OptionControl>

                    <controls:OptionControl x:Uid="AIAgentProcessingOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                        <StackPanel Spacing="12">
                            <ComboBox x:Uid="PreprocessWithAIAgent"
                                      VerticalAlignment="Center"
                                      ItemsSource="{x:Bind ViewModel.AIAgentsList}"
                                      SelectedItem="{x:Bind ViewModel.PreProcessorAIAgent, Mode=TwoWay}" />
                            <ComboBox x:Uid="PostprocessWithAIAgent"
                                      VerticalAlignment="Center"
                                      ItemsSource="{x:Bind ViewModel.AIAgentsList}"
                                      SelectedItem="{x:Bind ViewModel.PostProcessorAIAgent, Mode=TwoWay}" />
                        </StackPanel>
                    </controls:OptionControl>

                    <controls:OptionControl x:Uid="AIParametersOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                        <StackPanel Spacing="12">
                            <!--TODO: We will not translate the terms for now.-->
                            <ToggleSwitch x:Uid="/App.Resources/DoSampleToggle"
                                          Header="Sampling"
                                          IsOn="{x:Bind ViewModel.AgentSettingsModel.DoSample, Mode=TwoWay}" />
                            <Slider x:Uid="/App.Resources/AIOptionTopPSlider"
                                    Header="Top P"
                                    IsEnabled="{x:Bind ViewModel.AgentSettingsModel.DoSample, Mode=OneWay}"
                                    Maximum="1"
                                    Minimum="0"
                                    StepFrequency="0.01"
                                    Value="{x:Bind ViewModel.AgentSettingsModel.TopP, Mode=TwoWay}" />
                            <Slider x:Uid="/App.Resources/AIOptionTopKSlider"
                                    Header="Top K"
                                    IsEnabled="{x:Bind ViewModel.AgentSettingsModel.DoSample, Mode=OneWay}"
                                    Maximum="200"
                                    Minimum="0"
                                    StepFrequency="1"
                                    Value="{x:Bind ViewModel.AgentSettingsModel.TopK, Mode=TwoWay}" />
                            <Slider x:Uid="/App.Resources/AIOptionTemperatureSlider"
                                    Header="Temperature"
                                    IsEnabled="{x:Bind ViewModel.AgentSettingsModel.DoSample, Mode=OneWay}"
                                    Maximum="5"
                                    Minimum="0.01"
                                    StepFrequency="0.01"
                                    Value="{x:Bind ViewModel.AgentSettingsModel.Temperature, Mode=TwoWay}" />
                        </StackPanel>
                    </controls:OptionControl>

                </StackPanel>
            </controls:AdvancedSettingsControl>

        </StackPanel>
    </controls:AddressSettingsView>
</local:LocalAIAgentSettingsPageBase>
