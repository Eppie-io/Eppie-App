<local:AllMessagesPageBase x:Class="Eppie.App.Views.AllMessagesPage"
                           xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                           xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                           xmlns:controls="using:Eppie.App.UI.Controls"
                           xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                           xmlns:extensions="using:Eppie.App.UI.Extensions"
                           xmlns:local="using:Eppie.App.Views"
                           xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                           xmlns:viewmodels="using:Tuvi.App.ViewModels"
                           Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                           NavigationCacheMode="Enabled"
                           mc:Ignorable="d">

    <local:AllMessagesPageBase.Resources>
        <ResourceDictionary>
            <viewmodels:AllMessagesPageViewModel x:Key="PageViewModel" />

            <XamlUICommand x:Key="DeleteItemCommand"
                           x:Uid="/App.Resources/DeleteButton"
                           Command="{Binding DeleteMessageCommand, Source={StaticResource PageViewModel}}">
                <XamlUICommand.IconSource>
                    <SymbolIconSource Symbol="Delete" />
                </XamlUICommand.IconSource>
                <XamlUICommand.KeyboardAccelerators>
                    <KeyboardAccelerator Key="Delete" />
                </XamlUICommand.KeyboardAccelerators>
            </XamlUICommand>

            <XamlUICommand x:Key="MarkAsReadItemCommand"
                           x:Uid="/App.Resources/MarkAsReadButton"
                           Command="{Binding MarkMessageAsReadCommand, Source={StaticResource PageViewModel}}">
                <XamlUICommand.IconSource>
                    <SymbolIconSource Symbol="Read" />
                </XamlUICommand.IconSource>
                <XamlUICommand.KeyboardAccelerators>
                    <KeyboardAccelerator Key="R" Modifiers="Control" />
                </XamlUICommand.KeyboardAccelerators>
            </XamlUICommand>

            <XamlUICommand x:Key="MarkAsUnreadItemCommand"
                           x:Uid="/App.Resources/MarkAsUnreadButton"
                           Command="{Binding MarkMessageAsUnreadCommand, Source={StaticResource PageViewModel}}">
                <XamlUICommand.IconSource>
                    <SymbolIconSource Symbol="Mail" />
                </XamlUICommand.IconSource>
                <XamlUICommand.KeyboardAccelerators>
                    <KeyboardAccelerator Key="U" Modifiers="Control" />
                </XamlUICommand.KeyboardAccelerators>
            </XamlUICommand>

            <XamlUICommand x:Key="FlagItemCommand"
                           x:Uid="/App.Resources/SetFlagButton"
                           Command="{Binding FlagMessageCommand, Source={StaticResource PageViewModel}}">
                <XamlUICommand.IconSource>
                    <SymbolIconSource Symbol="Flag" />
                </XamlUICommand.IconSource>
                <XamlUICommand.KeyboardAccelerators>
                    <KeyboardAccelerator Key="F" Modifiers="Control, Shift" />
                </XamlUICommand.KeyboardAccelerators>
            </XamlUICommand>

            <XamlUICommand x:Key="UnflagItemCommand"
                           x:Uid="/App.Resources/ClearFlagButton"
                           Command="{Binding UnflagMessageCommand, Source={StaticResource PageViewModel}}">
                <XamlUICommand.IconSource>
                    <SymbolIconSource Symbol="Flag" />
                </XamlUICommand.IconSource>
                <XamlUICommand.KeyboardAccelerators>
                    <KeyboardAccelerator Key="U" Modifiers="Control, Shift" />
                </XamlUICommand.KeyboardAccelerators>
            </XamlUICommand>

        </ResourceDictionary>
    </local:AllMessagesPageBase.Resources>

    <local:AllMessagesPageBase.DataContext>
        <StaticResource ResourceKey="PageViewModel" />
    </local:AllMessagesPageBase.DataContext>

    <Grid Padding="12,0,12,0">

        <controls:MessageListControl x:Name="MessageListControl"
                                     CancelMessagesDeleteCommand="{Binding CancelMessagesDeleteCommand, Mode=OneWay}"
                                     ExceptionOccurred="OnExceptionOccurred"
                                     IsDeleteInProcess="{Binding IsDeleteInProcess, Mode=OneWay}"
                                     IsWaitingForMoreMessages="{Binding MessageList.IsChanging, Mode=OneWay}"
                                     MessageClickCommand="{Binding OpenMessageCommand, Mode=OneWay}"
                                     Messages="{Binding MessageList, Mode=OneWay}"
                                     MessagesDeletedText="{Binding MessagesDeletedText, Mode=OneWay}"
                                     SelectedItemsChangedCommand="{Binding SelectedItemsChangedCommand}"
                                     SelectionMode="{Binding IsSelectMessagesMode, Mode=OneWay, Converter={StaticResource BoolToSelectionModeConverter}}"
                                     StartDragMessagesCommand="{Binding StartDragMessagesCommand}">

            <controls:MessageListControl.ItemTemplate>
                <DataTemplate x:DataType="viewmodels:IMessageInfo">
                    <UserControl PointerEntered="ListViewSwipeContainerPointerEntered" PointerExited="ListViewSwipeContainerPointerExited">
                        <Grid>
                            <SwipeControl>
                                <SwipeControl.LeftItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem x:Uid="/App.Resources/ToggleReadSwipeItem"
                                                   Background="{ThemeResource SystemAccentColor}"
                                                   Invoked="OnToggleReadSwipeItemInvoked">
                                            <SwipeItem.IconSource>
                                                <SymbolIconSource Symbol="Read" />
                                            </SwipeItem.IconSource>
                                        </SwipeItem>
                                    </SwipeItems>
                                </SwipeControl.LeftItems>
                                <SwipeControl.RightItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem Background="{StaticResource WarningBackgroundBrush}"
                                                   Command="{StaticResource DeleteItemCommand}"
                                                   Invoked="OnDeleteSwipeItemInvoked" />
                                    </SwipeItems>
                                </SwipeControl.RightItems>
                                <!--  It leaks see TVM-344  -->
                                <local:MessageItemView>
                                    <local:MessageItemView.ContextFlyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Command="{StaticResource MarkAsReadItemCommand}"
                                                            CommandParameter="{Binding}"
                                                            Visibility="{Binding IsMarkedAsRead, Converter={StaticResource InverseBoolToVisibilityConverter}}" />
                                            <MenuFlyoutItem Command="{StaticResource MarkAsUnreadItemCommand}"
                                                            CommandParameter="{Binding}"
                                                            Visibility="{Binding IsMarkedAsRead}" />
                                            <MenuFlyoutItem Command="{StaticResource FlagItemCommand}"
                                                            CommandParameter="{Binding}"
                                                            Visibility="{Binding IsFlagged, Converter={StaticResource InverseBoolToVisibilityConverter}}" />
                                            <MenuFlyoutItem Command="{StaticResource UnflagItemCommand}"
                                                            CommandParameter="{Binding}"
                                                            Visibility="{Binding IsFlagged}" />
                                            <MenuFlyoutItem Command="{StaticResource DeleteItemCommand}" CommandParameter="{Binding}" />
                                        </MenuFlyout>
                                    </local:MessageItemView.ContextFlyout>
                                </local:MessageItemView>
                            </SwipeControl>
                            <!--  It leaks see TVM-344  -->
                            <CommandBar x:Name="HoverCommandBar"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Background="Transparent"
                                        DefaultLabelPosition="Collapsed"
                                        OverflowButtonVisibility="Collapsed"
                                        Visibility="Collapsed">
                                <AppBarButton x:Uid="/App.Resources/DeleteButton"
                                              Command="{StaticResource DeleteItemCommand}"
                                              CommandParameter="{Binding}"
                                              Icon="Delete" />
                                <AppBarButton x:Uid="/App.Resources/MarkAsReadButton"
                                              Command="{StaticResource MarkAsReadItemCommand}"
                                              CommandParameter="{Binding}"
                                              Icon="Read"
                                              Visibility="{Binding IsMarkedAsRead, Converter={StaticResource InverseBoolToVisibilityConverter}}" />
                                <AppBarButton x:Uid="/App.Resources/MarkAsUnreadButton"
                                              Command="{StaticResource MarkAsUnreadItemCommand}"
                                              CommandParameter="{Binding}"
                                              Icon="Mail"
                                              Visibility="{Binding IsMarkedAsRead}" />
                                <AppBarButton x:Uid="/App.Resources/SetFlagButton"
                                              Command="{StaticResource FlagItemCommand}"
                                              CommandParameter="{Binding}"
                                              Icon="Flag"
                                              Visibility="{Binding IsFlagged, Converter={StaticResource InverseBoolToVisibilityConverter}}" />
                                <AppBarButton x:Uid="/App.Resources/SetFlagButton"
                                              Command="{StaticResource UnflagItemCommand}"
                                              CommandParameter="{Binding}"
                                              Icon="Flag"
                                              Visibility="{Binding IsFlagged}" />
                            </CommandBar>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="HoveringStates">
                                    <VisualState x:Name="HoverButtonsHidden" />
                                    <VisualState x:Name="HoverButtonsShown">
                                        <VisualState.Setters>
                                            <Setter Target="HoverCommandBar.Visibility" Value="Visible" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                        </Grid>
                    </UserControl>
                </DataTemplate>
            </controls:MessageListControl.ItemTemplate>

            <controls:MessageListControl.HeaderHolder>
                <TextBlock x:Uid="AllMessages"
                           Grid.Row="1"
                           FontWeight="Bold"
                           Style="{StaticResource NormalTextStyle}"
                           TextWrapping="NoWrap" />
            </controls:MessageListControl.HeaderHolder>

            <controls:MessageListControl.CommandBarHolder>
                <CommandBar OverflowButtonVisibility="Collapsed">

                    <AppBarButton x:Name="AIAgentButton"
                                  x:Uid="/App.Resources/AIAgentProcessMessageButton"
                                  IsEnabled="{x:Bind ViewModel.IsLocalAIEnabled, Mode=OneWay}"
                                  Visibility="{x:Bind ViewModel.IsLocalAIAvailable, Mode=OneWay}">
                        <FontIcon Glyph="&#xE99A;" />
                    </AppBarButton>

                    <AppBarButton x:Uid="/App.Resources/MarkAsReadButton"
                                  Command="{x:Bind ViewModel.MarkSelectedMessagesAsReadCommand, Mode=OneWay}"
                                  CommandParameter="{x:Bind MessageListControl.SelectedItems, Mode=OneWay}"
                                  Icon="Read"
                                  Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarButton x:Uid="/App.Resources/MarkAsUnreadButton"
                                  Command="{x:Bind ViewModel.MarkSelectedMessagesAsUnreadCommand, Mode=OneWay}"
                                  CommandParameter="{x:Bind MessageListControl.SelectedItems, Mode=OneWay}"
                                  Icon="Mail"
                                  Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarButton x:Uid="/App.Resources/SetFlagButton"
                                  Command="{x:Bind ViewModel.FlagSelectedMessagesCommand, Mode=OneWay}"
                                  CommandParameter="{x:Bind MessageListControl.SelectedItems, Mode=OneWay}"
                                  Icon="Flag"
                                  Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarButton x:Uid="/App.Resources/ClearFlagButton"
                                  Command="{x:Bind ViewModel.UnflagSelectedMessagesCommand, Mode=OneWay}"
                                  CommandParameter="{x:Bind MessageListControl.SelectedItems, Mode=OneWay}"
                                  Icon="Flag"
                                  Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarButton x:Uid="/App.Resources/DeleteButton"
                                  Command="{x:Bind ViewModel.DeleteSelectedMessagesCommand, Mode=OneWay}"
                                  CommandParameter="{x:Bind MessageListControl.SelectedItems, Mode=OneWay}"
                                  Icon="Delete"
                                  Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarSeparator Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarButton x:Uid="/App.Resources/SelectAllButton"
                                  Click="OnSelectAllButton"
                                  Icon="SelectAll"
                                  Visibility="{x:Bind ViewModel.IsSelectMessagesMode, Mode=OneWay}" />

                    <AppBarToggleButton x:Uid="/App.Resources/SelectionModeButton"
                                        Icon="Bullets"
                                        IsChecked="{x:Bind ViewModel.IsSelectMessagesMode, Mode=TwoWay}" />

                    <AppBarButton x:Uid="/App.Resources/UpdateButton"
                                  Command="{x:Bind ViewModel.RefreshMessagesCommand, Mode=OneWay}"
                                  Icon="Refresh" />
                </CommandBar>
            </controls:MessageListControl.CommandBarHolder>
        </controls:MessageListControl>
    </Grid>
</local:AllMessagesPageBase>
