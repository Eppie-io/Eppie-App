<UserControl x:Class="Tuvi.App.Shared.Controls.ProtonSettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:Tuvi.App.Shared.Controls"
             xmlns:converters="using:Tuvi.App.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="using:Tuvi.App.Shared.Controls"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
             d:DesignHeight="300"
             d:DesignWidth="400"
             mc:Ignorable="d">

    <UserControl.Resources>
        <x:Double x:Key="TextBoxWidth">276</x:Double>

        <x:Double x:Key="SignatureBoxHeight">80</x:Double>
        <x:Double x:Key="ErrorControlHeight">68</x:Double>

        <x:Double x:Key="NormalOptionGapHeight">36</x:Double>
        <x:Double x:Key="ErrorOptionGapHeight">0</x:Double>
    </UserControl.Resources>

    <StackPanel>
        <StackPanel>
            <controls:AddressControl Address="{x:Bind ProtonAddressSettingsModel.Email.Value, Mode=OneWay}" Visibility="{x:Bind IsEmailReadOnly, Mode=OneWay}">
                <!--
                    ToDo: Issue #931 - Perhaps some logic needs to be added.
                    `Connecting...` - if the `AccountSettingsPageViewModel.IsWaitingResponse` is ture
                    `Disconnected` - if the connection is not established
                -->
                <TextBlock x:Uid="/Eppie.App.UI/Controls/ConnectionStatus"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"
                           TextAlignment="Right" />
            </controls:AddressControl>

            <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/EmailAddressOption"
                                    GapHeight="{StaticResource ErrorOptionGapHeight}"
                                    Visibility="{x:Bind IsEmailReadOnly, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                <local:ErrorControl Height="{StaticResource ErrorControlHeight}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Property="{x:Bind ProtonAddressSettingsModel.Email, Mode=OneWay}">
                    <TextBox x:Uid="/Eppie.App.UI/Controls/EmailAddressBox"
                             Width="{StaticResource TextBoxWidth}"
                             HorizontalAlignment="Left"
                             VerticalAlignment="Top"
                             IsReadOnly="{x:Bind IsEmailReadOnly, Mode=OneWay}"
                             IsSpellCheckEnabled="False"
                             Text="{x:Bind ProtonAddressSettingsModel.Email.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </local:ErrorControl>
            </controls:OptionControl>

            <!--
                ToDo: Issue #931 - The application does not store this option.
                It is a temporary solution for adding and changing a Proton account. UX should be changed.
            -->
            <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/PasswordOption"
                                    GapHeight="{StaticResource ErrorOptionGapHeight}"
                                    Visibility="{x:Bind ProtonAddressSettingsModel, Mode=OneWay, Converter={StaticResource ObjectToVisibilityConverter}}">
                <local:ErrorControl Height="{StaticResource ErrorControlHeight}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{x:Bind ProtonAddressSettingsModel, Mode=OneWay, Converter={StaticResource ObjectToVisibilityConverter}}"
                                    Property="{x:Bind ProtonAddressSettingsModel.Password, Mode=OneWay}">
                    <PasswordBox x:Uid="/Eppie.App.UI/Controls/PasswordBox"
                                 Width="{StaticResource TextBoxWidth}"
                                 HorizontalAlignment="Left"
                                 VerticalAlignment="Top"
                                 Password="{x:Bind ProtonAddressSettingsModel.Password.Value, Mode=TwoWay}" />
                </local:ErrorControl>
            </controls:OptionControl>

            <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/SenderNameOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                <TextBox x:Uid="/Eppie.App.UI/Controls/SenderNameBox"
                         Width="{StaticResource TextBoxWidth}"
                         HorizontalAlignment="Left"
                         VerticalAlignment="Top"
                         IsSpellCheckEnabled="False"
                         Text="{x:Bind ProtonAddressSettingsModel.SenderName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            </controls:OptionControl>

            <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/SignatureOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                <controls:OptionControl.InlineNote>
                    <Span>
                        <Run x:Uid="/Eppie.App.UI/Controls/SignatureNote" />
                        <LineBreak />
                        <LineBreak />
                        <Hyperlink NavigateUri="{Binding Homepage, Source={StaticResource Brand}}">
                            <Run x:Uid="/Eppie.App.UI/Controls/SignatureLink" />
                        </Hyperlink>
                    </Span>
                </controls:OptionControl.InlineNote>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <ToggleSwitch x:Name="SignatureSwitch" IsOn="{x:Bind ProtonAddressSettingsModel.IsMessageFooterEnabled, Mode=TwoWay}" />
                    <TextBlock Grid.Column="1"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"
                               FontSize="14"
                               TextAlignment="Right"
                               TextTrimming="CharacterEllipsis">
                        <Span>
                            <Run x:Uid="/Eppie.App.UI/Controls/DefaultSignatureFirstPart" />
                            <Hyperlink NavigateUri="{Binding Homepage, Source={StaticResource Brand}}">
                                <Run Text="{Binding AppName, Source={StaticResource Brand}}" />
                            </Hyperlink>
                            <Run x:Uid="/Eppie.App.UI/Controls/DefaultSignatureSecondPart" />
                        </Span>
                    </TextBlock>
                    <TextBox x:Uid="/Eppie.App.UI/Controls/SignatureBox"
                             Grid.Row="1"
                             Grid.ColumnSpan="2"
                             Height="{StaticResource SignatureBoxHeight}"
                             HorizontalAlignment="Stretch"
                             AcceptsReturn="True"
                             IsEnabled="{x:Bind SignatureSwitch.IsOn, Mode=OneWay}"
                             Text="{x:Bind ProtonAddressSettingsModel.MessageFooter, Mode=TwoWay}" />
                </Grid>
            </controls:OptionControl>
        </StackPanel>

        <controls:AdvancedSettingsControl HideResetButton="True" IsAdvancedModeActive="{x:Bind IsAdvancedSettingsModeActive, Mode=TwoWay}">
            <StackPanel>
                <!--
                    ToDo: Issue #931 - The application does not store this option.
                    It is a temporary solution for adding and changing a Proton account. UX should be changed.
                -->
                <controls:OptionControl Caption="Two-factor authentication"
                                        GapHeight="{StaticResource NormalOptionGapHeight}"
                                        HideNote="True">
                    <local:ErrorControl HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Property="{x:Bind ProtonAddressSettingsModel.TwoFactorCode, Mode=OneWay}">
                        <TextBox Width="{StaticResource TextBoxWidth}"
                                 HorizontalAlignment="Left"
                                 VerticalAlignment="Top"
                                 IsSpellCheckEnabled="False"
                                 PlaceholderText="Enter code"
                                 Text="{x:Bind ProtonAddressSettingsModel.TwoFactorCode.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    </local:ErrorControl>
                </controls:OptionControl>

                <!--
                    ToDo: Issue #931 - The application does not store this option.
                    It is a temporary solution for adding and changing a Proton account. UX should be changed.
                -->
                <controls:OptionControl Caption="Mailbox Password"
                                        GapHeight="{StaticResource NormalOptionGapHeight}"
                                        HideNote="True">
                    <local:ErrorControl HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Property="{x:Bind ProtonAddressSettingsModel.MailboxPassword, Mode=OneWay}">
                        <PasswordBox x:Uid="/Eppie.App.UI/Controls/PasswordBox"
                                     Width="{StaticResource TextBoxWidth}"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Top"
                                     Password="{x:Bind ProtonAddressSettingsModel.MailboxPassword.Value, Mode=TwoWay}" />
                    </local:ErrorControl>
                </controls:OptionControl>

                <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/BackupOption" GapHeight="{StaticResource NormalOptionGapHeight}">
                    <StackPanel Orientation="Vertical">
                        <CheckBox x:Name="BackupAccountSettingsCheckBoxNew"
                                  x:Uid="/Eppie.App.UI/Controls/BackupSettingsCheckBox"
                                  IsChecked="{x:Bind ProtonAddressSettingsModel.IsBackupAccountSettingsEnabled, Mode=TwoWay}" />
                        <CheckBox x:Uid="/Eppie.App.UI/Controls/BackupMessagesCheckBox"
                                  IsChecked="{x:Bind ProtonAddressSettingsModel.IsBackupAccountMessagesEnabled, Mode=TwoWay}"
                                  IsEnabled="{x:Bind BackupAccountSettingsCheckBoxNew.IsChecked, Mode=OneWay, Converter={StaticResource NullableBoolToBoolConverter}}" />
                    </StackPanel>
                </controls:OptionControl>

                <!--  ToDo: Issue #931 - The layout is broken if there is an error  -->
                <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/SynchronizationIntervalOption"
                                        GapHeight="{StaticResource NormalOptionGapHeight}"
                                        HideNote="True">
                    <StackPanel Orientation="Horizontal">
                        <local:ErrorControl HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            Property="{x:Bind ProtonAddressSettingsModel.SynchronizationInterval, Mode=OneWay}">
                            <TextBox IsSpellCheckEnabled="False" Text="{x:Bind ProtonAddressSettingsModel.SynchronizationInterval.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </local:ErrorControl>
                        <TextBlock x:Uid="/Eppie.App.UI/Controls/SynchronizationIntervalUnits"
                                   Margin="12,0"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </controls:OptionControl>

                <controls:OptionControl x:Uid="/Eppie.App.UI/Controls/HybridAddressOption"
                                        GapHeight="{StaticResource NormalOptionGapHeight}"
                                        Visibility="{x:Bind ShowHybridAddressButton, Mode=OneWay}">
                    <Button x:Uid="/Eppie.App.UI/Controls/HybridAddressButton" Command="{x:Bind CreateHybridAddressCommand}" />
                </controls:OptionControl>
            </StackPanel>
        </controls:AdvancedSettingsControl>
    </StackPanel>
</UserControl>
